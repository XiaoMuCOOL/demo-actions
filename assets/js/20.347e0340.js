(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{383:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("Gitlab 相关的一些安装、命令、操作记录。")]),t._v(" "),s("h2",{attrs:{id:"安装-gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-gitlab"}},[t._v("#")]),t._v(" 安装 gitlab")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" update               // 更新软件源\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker.io -y // 安装docker\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull gitlab/gitlab-ee:latest  // 拉取镜像\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d  -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(":443 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":22 --name gitlab --restart always -v /home/gitlab/config:/etc/gitlab -v /home/gitlab/logs:/var/log/gitlab -v /home/gitlab/data:/var/opt/gitlab gitlab/gitlab-ee\n")])])]),s("p",[t._v("gitlab结果："),s("code",[t._v("6e6b93f21e379e40a50a2468025d10d82067d9c0a6635ac0fe1090fc59fd4c4b")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /home/gitlab/config/gitlab.rb\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置http协议所使用的访问地址,不加端口号默认为80")]),t._v("\nexternal_url "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://47.103.58.85'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置ssh协议所使用的访问地址和端口")]),t._v("\ngitlab_rails"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab_ssh_host'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'47.103.58.85'")]),t._v("\ngitlab_rails"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'gitlab_shell_ssh_port'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此端口是run时22端口映射的22端口")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" restart gitlab\n")])])]),s("p",[t._v("gitlab 用户名:root  初始密码：在config里，Weijin@Root")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d  -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(":443 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(":80 -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("222")]),t._v(":22 --name gitlab-ce --restart always -v /home/gitlab/config:/etc/gitlab -v /home/gitlab/logs:/var/log/gitlab -v /home/gitlab/data:/var/opt/gitlab gitlab/gitlab-ce\n")])])]),s("p",[t._v("结果："),s("code",[t._v("3125c038a09574b76a390dcda2a895b2f2402b7b78b5451891ece17358a1b510")])]),t._v(" "),s("h1",{attrs:{id:"启动-重启-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动-重启-runner"}},[t._v("#")]),t._v(" 启动/重启 Runner")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8093")]),t._v(":8093 --name gitlab-runner --restart always "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n     -v /home/gitlab-runner/config:/etc/gitlab-runner "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n     -v /var/run/docker.sock:/var/run/docker.sock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n     gitlab/gitlab-runner:latest\n")])])]),s("p",[t._v("结果："),s("code",[t._v("bab6921ec13264ab84d364590f7c8bd3a3a969739a044a5abf1e67f249c043ab")])]),t._v(" "),s("h3",{attrs:{id:"注册runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册runner"}},[t._v("#")]),t._v(" 注册runner")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 手动填写参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run --rm -it -v /home/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或命令行预设参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("  run --rm -it gitlab/gitlab-runner register -n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --url http://47.103.58.85 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --registration-token tsiKxKgEm648JnzaSSMz "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --tag-list saas-dev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --executor "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --docker-image "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --docker-volumes /home/gitlab-runner/.m2:/root/.m2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --docker-volumes /home/gitlab-runner/.npm:/root/.npm "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --docker-volumes /home/gitlab-runner/config:/etc/gitlab-runner "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --docker-volumes /var/run/docker.sock:/var/run/docker.sock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n       --description "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker镜像saas-dev服务器"')]),t._v("\n")])])]),s("h1",{attrs:{id:"辣鸡runner-配置要写死docker版本-不然哭死你"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#辣鸡runner-配置要写死docker版本-不然哭死你"}},[t._v("#")]),t._v(" 辣鸡runner，配置要写死docker版本，不然哭死你")]),t._v(" "),s("p",[s("code",[t._v("/home/gitlab-runner/config/config.toml")])]),t._v(" "),s("div",{staticClass:"language-YML extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v("concurrent = 1\ncheck_interval = 0\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("session_server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  session_timeout = 1800\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("runners"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v('\n  name = "docker镜像saas'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('dev服务器"\n  url = "http'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('//47.103.58.85"\n  token = "Czy9o_uDiect'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("k4UMF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('6"\n  executor = "docker"\n  '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("runners.custom_build_dir"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("runners.cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("runners.cache.s3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("runners.cache.gcs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("runners.cache.azure"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("runners.docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v('\n    tls_verify = false\n    image = "docker'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('19.03.12"\n    privileged = true\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/run/docker.sock:/var/run/docker.sock"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/cache"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    shm_size = 0\n")])])]),s("h3",{attrs:{id:"验证runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证runner"}},[t._v("#")]),t._v(" 验证runner")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run --rm -it -v /home/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner verify\n")])])]),s("h2",{attrs:{id:"gitlab-ci-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-配置"}},[t._v("#")]),t._v(" Gitlab-CI 配置")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.gitlab.cn/jh/ci/yaml/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v(".gitlab-ci.yml"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认镜像")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ruby"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.0")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果要启动运行命令或脚本")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ruby"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.6")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 命令或脚本")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("entrypoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/bash"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 额外的 Docker 镜像来运行脚本。services 镜像链接到 image 关键字中指定的镜像")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("postgres"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11.7")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alias")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("postgres\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("entrypoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/bin/db-postgres"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 阶段")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stages")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 阶段名称")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" test\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自定义变量")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("variables")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 变量 key: value")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("DEPLOY_VARIABLE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default-deploy"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 流水线")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("workflow")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 规则")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 具体规则")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$CI_PIPELINE_SOURCE == \"schedule\"'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当 IF 为 true 时，是否执行流水线")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" never\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$CI_PIPELINE_SOURCE == \"push\"'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" never\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 除了上面指定的规则是 never，其他都是 always")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作业/任务")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 所属阶段")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ruby"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 规则")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /^feature/ && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME != $CI_DEFAULT_BRANCH'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" never\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$CI_MERGE_REQUEST_SOURCE_BRANCH_NAME =~ /^feature/'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("when")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" manual\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("allow_failure")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$CI_MERGE_REQUEST_SOURCE_BRANCH_NAME'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 执行脚本")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "Check the ruby version'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" then build some Ruby project files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('"\n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ruby "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" rake\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 作业/任务")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("job2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "If the files are built successfully'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" test other files with a different command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('"\n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" rake test2\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);