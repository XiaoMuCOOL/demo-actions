(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{419:function(a,t,s){"use strict";s.r(t);var n=s(1),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("等保优化，服务器优化。")]),a._v(" "),t("h2",{attrs:{id:"服务器优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器优化"}},[a._v("#")]),a._v(" 服务器优化")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("// 安装PAM（Pluggable Authentication Modules 插件式认证模块）的cracklib模块\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" libpam-cracklib\n// 打开 配置文件\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/pam.d/common-password\n// 修改为\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("minlen")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("minclass")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" enforce_for_root "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("dcredit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("-1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("lcredit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("-1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ucredit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("-1 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ocredit")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("-1\n\n// 将用户口令有效期改为90天\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/login.defs\n// 修改为\nPASS_MAX_DAYS   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("90")]),a._v("\n// 已经创建的用户修改\n$ chage "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-M")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("90")]),a._v(" 用户名\n\n// 登录次数限制\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/pam.d/common-auth\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/pam.d/login\n// 在第一行添加并注释 pam_tally.so 行\nauth        required      pam_faillock.so "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("deny")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" even_deny_root "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("unlock_time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("300")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#  pam_tally.so   那一行注释掉 ")]),a._v("\n\n// 空闲超时自动退出\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/profile\n// 最后一行添加\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TMOUT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("300")]),a._v("\n// 运行\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" /etc/profile\n\n// 三权分立\n// 系统管理员账户\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("useradd")]),a._v(" sysadmin\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("passwd")]),a._v(" sysadmin\n// 审计管理员账户\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("useradd")]),a._v(" audadmin\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("passwd")]),a._v(" audadmin\n// 安全管理员账户\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("useradd")]),a._v(" secadmin\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("passwd")]),a._v(" secadmin\n^1Mqss^R7%2G\n\n// 安装audit审计服务\n\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt-get")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" auditd\n// 编辑配置文件\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/audit/rules.d/audit.rules\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" /etc/passwd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" rwxa\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" /etc/profile "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" rwxa\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" /etc/sysctl.conf "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" rwxa\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" /etc/crontab "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" rwxa\n// 重启auditd服务\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" auditd restart\n\n// 发送日志到堡垒机\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/rsyslog.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 等保配置")]),a._v("\n*.*\t\t@172.28.95.161\n// 重启服务\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart rsyslog\n\n// 添加数据库审计\n// 上传文件packetbeat和packetbeat.yml到/opt/dbaudit/目录下\n// 设置权限\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("777")]),a._v(" /opt/dbaudit/packetbeat.yml\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("755")]),a._v(" /opt/dbaudit/packetbeat\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /opt/dbaudit/\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" go-w packetbeat ./packetbeat.yml\n// 运行\n$ ./packetbeat run\n// 退出\n$ ctrl+z\n\n// 修改日志保存6个月\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/logrotate.conf\nrotate "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("26")]),a._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/logrotate.d/wtmp\nrotate "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v("\n\n// 禁止root登录\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/ssh/sshd_config\nPermitRootLogin no\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" sshd restart\n")])])]),t("p",[a._v("最后在Confluence 页面上修改基本URL，修改路径："),t("code",[a._v("设置->一般配置->站点配置->服务器主页URL")]),a._v(" 修改为："),t("code",[a._v("http://wiki.ant-lord.com")]),a._v(" 就可以了。")])])}),[],!1,null,null,null);t.default=e.exports}}]);